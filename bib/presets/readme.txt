



□ 指定マニュアル 2013/09/28 版




かんたんですが、プリセットについて解説します。
今後マニュアルにまとめる計画ですので、読みづらさはしばしご容赦ください。



■プリセットとは / つかいかた

プリセットファイルとは、
リーダとしてのデフォルト挙動やレイアウトの初期設定を外部化したテキストファイルで、
これを編集することでビビをカスタマイズすることができます。

プリセットファイルは bib/preset/ フォルダに入れてつかいます。
URL のハッシュにつける bibi(preset:ファイル名.js) で使い分けることができます。

EPUB をドラッグアンドドロップしてもらうときも予め設定を読ませておけますし、
（http://anatano.website/bib/i/#bibi(preset:PRESET.js)）
サーバに置いた EPUB やフォルダを読むときも、プリセットをペアにした URL を発行できます。
（http://anatano.website/bib/i/?book=EPUB.epub#bibi(preset:PRESET.js)）
（http://anatano.website/bib/i/?book=EPUB#bibi(preset:PRESET.js)）

指定がないときは、bib/preset/ フォルダ内にある default.js が使用されます。
まずは default.js を編集して使うのがよいかもしれません。

以下、具体的な指定について説明しますが、
多くは、対象とする EPUB によって一長一短があります。
だからこそプリセットとして編集可能にしてあるというわけです。

読者自身が読みながらボタンで変更できる項目もありますが、
ご自身で作成した EPUB を読者に見せたい場合や、
ご自身で見た目をカスタマイズした BiB/i を読者に使ってもらいたい場合など、
EPUB に合わせたスタイルやあなたらしいスタイルを予めプリセットで指定しておくと、
きっとステキだと思いますよ☆

（要は投げているのです。）
（いえ、ウソです、ちゃんとデフォルトということを考慮してます。）


★この文書内で使用される用語の定義

アイテムとは、表示されるファイルひとつひとつのことです。

カギ括弧つきの「見開き」とは、アイテムをつつむブロックです。
リフロー指定のアイテムはそれ１つだけで「見開き」を構成します。
固定レイアウトで左右ペアが作られている場合は、その２つが１つの「見開き」に入ります。

カギ括弧つきの「長さ」は、見開きの進行方向サイズのことです。
横並びなら左右幅、縦並びなら上下高にあたります。
同様に、カギ括弧付きの「広さ」は、横並びなら上下高、縦並びなら左右幅です。
そして、カギ括弧つきで「短い」「狭い」といえば、それらの数値が小さい状態を示します。


■ name: "なまえ" …… プリセットの任意名称

いまのところどこにも使用されていませんが、
いつかコントロールパネルからプリセットを切り替える機能をつけるかもしれず、
その暁には設定パネル内でラベルとして使用される予定であります。


■ description: "説明" …… プリセットの内容説明

これも、切り替え機能で使うかもしれない予定です。


■ "book-display-mode" …… 表示モードの初期値（全部・「見開き」ごと）

"all" を指定すると、書籍の表示データすべてを並べます。
"each" では「見開き」単位に表示して、端まで表示すると前後のアイテムに切り替えるようになります。
（かつて "item" という指定でアイテム単位表示にできましたが、機能自体を廃止しました）
（"item" モードの廃止に伴い、「見開き」単位の指定は "spread" から "each" に変更しました。……まだ迷いが残っています）

読者は随時変更できるので、あくまで最初にどのモードで表示するか、ということです。


■ "page-progression-direction" …… ページめくり方向の初期値

EPUB 側で page-progression-direction が未指定もしくは "default" だった場合に、
ページめくり方向として選択されます。
BiB/i はスクロールベースのリーダなので「ページってなんだよ」と思われるかもしれませんが、
これは固定レイアウトで２ページが見開きになるときの配置方向にも関わるのです。
また、固定レイアウトや縦書きのときはスクロール方向にも反映されます。

オプションにせず "ltr" 固定にしようかとも思いました。
というのも、まあ世界的に考えてあたりまえといえばあたりまえですが、
「リーダ側のデフォルトは "ltr" である」という想定でつくられている EPUB が大半なのです。

でも「リーダ側のデフォルトは "ltr" であるべき」という仕様はありませんでしたので、
単純に暗黙の了解にしてしまうのもなんだかなと思い、残してあります。

とはいえ、"ltr" としておくのがオススメです。

たとえば、日本語縦書きやアラビア語に特化した最適化をしたいときなど、
非常に限られた場合に、"rtl" にしておくと便利な場合が、あるかもしれません。
ただ、ふつうは実際問題として困ったことになる場合がほとんどかと思います。


■ "spread-layout-axis" …… 見開き配置方向の初期値

"auto" / "vertical" / "horizontal" の３つが指定でき、それに基づいて、
内部的な値である "spread-layout-direction" が "ttb" / "ltr" / "rtl" のいずれかに落とし込まれます。
（かつて直接 "spread-layout-direction" をプリセットで指定できるようになっていましたが、廃止しました）

"spread-layout-axis" も "spread-layout-direction" も、
EPUB 内の page-progression-direction やプリセットの "page-progression-direction"、
そして本が固定レイアウト（"pre-paginated"）であるかどうかなどによって値が決定されます。

ページめくり方向が "ltr" / "rtl" を想定して作成されている EPUB に敢えて "vertical" を指定すると（その逆も）、
便利だったり読みやすかったりする場合があります。

いずれにせよこれはデフォルト値で、
見開き配置方向＝スクロール方向は、ボタンで読者が随時変更できます。


■ "page-size-format" …… 仮想「ページ」の比率（旧 "spread-orientation", "page-orientation"）

（初回リリース時は "spread-orientation" という名称で、
　その後 "page-orientation" に変更しましたが、
　制御する内容に合わせて再度変更されました。おそらくもう変わりません）

ビビはスクロールベースのリーダですが、
仮想の「ページ」という概念を持っています。

この設定項目は「ページ」の寸法比率をどのようにとるかの設定で、
横書きの本を横配置（縦書きの本を縦配置）したときの段組幅や、
前後移動アローを押したときの移動距離に関わります。

"auto" / "window" / "portrait" / "landscape" が指定できますが、この仕様はまだ不確定です。
いまは "auto" にしておくのがオススメですが、
横書きの本を横配置するときなどに "portrait" がキレイにはまる場合があります。

ちかく、読者が変更できるようにボタンをつける予定です。


■ "book-background" …… 見開きの下の背景

CSS の background そのままでどうぞ。つまり背景画像なども使えます。


■ "spread-gap" …… 見開きと見開きの間隔（旧 "spread-separation"）

見開き同士の間隔です。単位は px。

"spread-layout-direction" が "vertical"（"ttb"）なら上下、
"horizontal"（"ltr" / "rtl"）なら左右の間隔です。

最初と最後の見開きとウィンドウ端の距離は、この半分の値になります。
その計算を「美しく」行うため、プリセットで奇数値が指定されていても、1足して強制的に偶数にしています。
（小数点以下を含む指定は偶数奇数の判断の前に四捨五入してしまいます）

後述の "center-end-spread" が有効である場合、
最初と最後の見開きはウィンドウの真ん中に来るようにウィンドウ端との距離が調節されます。

また、これも含め、"_narrow-device" が付いた指定は、iOS と Android の場合に優先されます。
ただし、現状はメディアクエリほかでスクリーンサイズを判別したりはしていません。


■ "spread-margin-start" / "spread-margin-before" …… 見開きとウィンドウの間隔

見開きとウィンドウの、見開き配置方向と垂直方向にあたる側の間隔です。単位は px。

"spread-margin-start" は、
"spread-layout-direction" が "vertical"（"ttb"）の場合、
"page-progression-direction" が "ltr" ならば左、"rtl" なら右です。
"spread-layout-direction" が "horizontal"（"ltr" / "rtl"）なら 上となります。

"spread-margin-end" は "spread-margin-start" の反対側です。


■ "spread-border-radius" …… 見開きのカドを丸めるならその半径

CSS 3 でできるようになったことのうち、
多くのウェブ制作者がもっともわかりやすく小躍りしたという言い伝えがある、カド丸指定です。
CSS の border-radius そのままなので、お好みでどうぞ。


■ "spread-box-shadow" …… 見開きに影を付けるなら CSS を

カド丸に並びウェブ制作者を小躍りさせたと語り伝えられる、影指定。
CSS の box-shadow そのままです。

影を付けるとすこしスクロールがもたつくかもしれませんので、
ないほうがいいかもしれませんね。不要なら "none" もしくは "" としてください。



■ "item-padding-left" / "item-padding-right" / "item-padding-top" / "item-padding-bottom" …… 各アイテム内の余白

見開き内、コンテンツまでの余白です。

数値の単位はすべて px（ピクセル）。

グチですが……ホントは全部 0 でいいはずじゃないかと思うんです。
ただ、iBooks はじめ、制御不能な余白をつけるリーディングシステムが幅を利かせています。
あれはほんとうにキライですが、そう言っても仕方ありません。
内部の CSS に余白を持たせていない EPUB がかなり多く、この項目はそのためにあります。

アイテムが固定レイアウトのときは無視され、余白はとられません。


■ "item-column-rule" …… 段組されたときの境界線表示

CSS の column-rule そのままです。不要なら "" 空値にしておきます。

ちなみにビビではなく CSS の領分の話ですが、この線の太さは、column-gap に影響しません。




